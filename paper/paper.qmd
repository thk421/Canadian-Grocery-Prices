---
title: "Predicting Grocery Price Trends Using Bayesian Models"
subtitle: "An analysis of price patterns across Canadian grocery vendors to identify the most beneficial vendor for consumers"
author: Tina Kim
thanks: "Code and data are available at: https://github.com/thk421/Canadian-Grocery-Prices.git"
date: today
date-format: long
abstract: "This study uses Bayesian statistical models to analyze grocery price trends across eight Canadian vendors by examining current and historical grocery price data. Our findings show that vendor-specific factors and product type significantly influence price changes. This research provides actionable insights for consumers and vendors looking to optimize their grocery purchasing and pricing strategies while adhering to the 2019 Canada's Food Guide, especially in light of the growing demand for affordable, sustainable food choices."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(brms)
library(ggplot2)
library(lubridate)
library(arrow)
library(knitr)

analysis_data <- read_parquet(here::here("data/02-analysis_data/analysis_data.parquet"))
```


# Introduction

Overview paragraph

The 2019 Canada's Food Guide (CFG) [@cfg2019] emphasizes the importance of balanced nutrition, advocating for a diet rich in vegetables, fruits, whole grains, and protein foods sourced from both plants and animals. It encourages reducing saturated fats, added sugars, and highly processed foods while recommending unsweetened, lower-fat milk or fortified plant-based alternatives. Notably, the 2019 CFG introduces greater flexibility compared to previous editions by integrating dairy products into the broader protein foods category, reflecting a more inclusive approach to nutrition. 

However, adhering to the 2019 CFG has become increasingly challenging due to rising grocery costs. A basket of groceries that cost \$1,000 five years ago now costs approximately $1,296 in 2024 [@rbc_grocery_costs]. This escalation forces consumers to make more informed and difficult choices, often weighing the affordability of less healthy but cheaper options against the higher costs of healthier alternatives. 

To address this issue, our study explores grocery pricing trends across eight Canadian vendors: Metro, Save-On-Foods, Galleria, T&T Supermarket, Voilà, Walmart, No Frills, and Loblaws. By examining predictors such as product categories, vendor pricing, and temporal trends, this research provides critical insights into the dynamics of grocery pricing. Additionally, Bayesian statistical methods are employed to model future price changes, offering valuable tools for consumers and policymakers navigating the growing challenges of maintaining healthy, cost-effective diets.

Estimand paragraph

The key estimand of this study is the effect of vendor choice, product category, and temporal trends on grocery pricing across Canada. Specifically, we aim to estimate how much more or less consumers might pay for certain product categories when purchasing from different vendors, considering the ongoing trends in grocery pricing and the role that seasonal and economic shifts play. Through this analysis, we seek to estimate the probability of future price decreases or increases based on these factors.

Another key estimand is the lowest total cost of constructing a week’s worth of meals using commonly available ingredients that adhere to the 2019 CFG, tailored for each vendor. All analysis is conducted using a standardized price measure to ensure consistency, comparability, and fairness across products, units, vendors, and contexts. Since prices are often reported in various units (e.g., kilograms, grams, liters, or milliliters), standardizing them to a common unit (such as grams, milliliters, or individual items) eliminates variability caused by differing measurement scales, enabling accurate and direct comparisons. This comparison extends beyond affordability to also consider quality, reliability, transparency, and appeal to calculate an overall score measure. Quality is assessed by comparing if the product is organic or not. Reliability is based on stock availability. Transparency is measured through quiet price decreases. Lastly, best seller or sale promotions are integrated for appeal. This composite metric provides a comprehensive rating for each vendor to offer tailored recommendations, helping consumers identify the vendor that best aligns with their specific needs and priorities.

Results paragraph

The analysis reveals that vendor choice plays a significant role in determining grocery prices, with large national vendors generally offering lower prices compared to local or regional options. Furthermore, we observe a clear seasonal trend in grocery pricing, with prices typically rising in the winter months and dropping during certain sales periods. The model also indicates that certain product categories, particularly organic and plant-based foods, are subject to higher price volatility, while staple items such as grains and protein foods remain relatively stable.

Why it matters paragraph

Understanding how pricing trends vary across different vendors and product categories is crucial for consumers seeking to optimize their grocery spending while adhering to the dietary guidelines outlined by Canada's Food Guide. This research not only informs consumer decision-making but also provides valuable insights for policymakers and vendors aiming to address food accessibility and affordability in Canada. By modeling future price trends, we can better anticipate and prepare for fluctuations in grocery costs, helping people in Canada make healthier, more cost-effective food choices.

Telegraphing paragraph: The remainder of this paper is structured as follows. @sec-data describes the data used in the analysis, @sec-model details the Bayesian model and assumptions, @sec-results presents the results, and @sec-discussion offers a discussion of the findings and suggests areas for future research.


# Data {#sec-data}

## Overview

The "Canadian Grocery Price Data" dataset was sourced from Project Hammer [@grocery_data], and a statistical analysis was performed using the R programming language [@citeR]. The primary objective of this analysis was to clean, explore, and visualize the data to identify which grocery vendor currently and in the future offers the most cost-effective options for individuals adhering to the 2019 CFG. Various R libraries were utilized throughout the process. The tidyverse library [@tidyverse] provides a comprehensive set of tools for data manipulation, cleaning, and visualization, enabling efficient handling of datasets. The lubridate library [@lubridate] simplifies working with date-time objects while arrow [@arrow] is used to handle large datasets efficiently, especially for columnar formats like Parquet. For Bayesian modeling, rstanarm [@rstanarm] and brms [@brms] offer powerful tools for fitting and interpreting multilevel models while bayesplot [@bayesplot] aids in the graphical exploration of Bayesian model results, enhancing the interpretation of complex models. A summary table showcasing 10 sample observations from the cleaned dataset is presented in @tbl-grocery-data-summary. The table was divided into Part 1 and Part 2 for better readability, but the original dataset is formatted as one continuous table.

```{r}
#| label: tbl-grocery-data-summary
#| tbl-cap: "Sample Canadian Grocery Price Data"
#| echo: false
#| warning: false
#| message: false

# First table with columns 1 to 5
analysis_data %>%
  slice(379030:379040) %>%
  select(1:5) %>%  # Selecting first 5 columns
  kable(caption = "Sample Canadian Grocery Price Data - Part 1", align = rep("c", 5))

# Second table with columns 5 to the end
analysis_data %>%
  slice(379030:379040) %>%
  select(6:ncol(analysis_data)) %>%  # Selecting columns 6 to the last
  kable(caption = "Sample Canadian Grocery Price Data - Part 2", align = rep("c", ncol(analysis_data)-5))

```

## Measurement
	
Some paragraphs about how we go from a phenomena in the world to an entry in the dataset.

In this analysis, the phenomenon of interest is the cost of constructing a meal plan based on the 2019 CFG by going through grocery prices of different products from various vendors. The original Canadian Grocery Price Data from Project Hammer used in this analysis came in two files, one containing metadata and product details, and the other containing time-series price data. The files were merged into one dataset and select variables were chosen to construct the analysis data for this paper. Detailed cleaning steps for the analysis data can be seen in @sec-appendix-B.

After the cleaning process, we are left with a dataset containing several attributes for our analysis such as vendor, product, price, and food category. Through these steps, we systematically translate complex real-world phenomena into structured, analyzable data that can be used to answer research questions about grocery pricing dynamics.

## Outcome variables

**Price per Unit**
- The primary outcome variable in our study is the price per unit of each product. This outcome variable captures the key phenomenon we are interested in: how much consumers are paying per unit of a product, after accounting for varying packaging sizes and vendor pricing strategies. It is calculated by dividing the current price by the unit size (in grams, milliliters, or items) for each product. This allows us to standardize prices across different products that may be sold in different quantities. The calculation of price per unit is crucial for comparing products sold in various units of measurement and understanding the underlying cost dynamics of each product.

```{r}
#| label: tbl-price-per-unit
#| tbl-cap: "Summary of price per unit across product categories and vendors"
#| echo: false
#| warning: false
#| message: false

```

**Overall Vendor Score**
- Another outcome variable is the overall vendor score, which takes into account multiple criteria to evaluate vendors. The highest weight is put on affordability which is measured by the average price per unit of groceries from each vendor. Some additional factors taken into account are whether products are organic (quality), are in stock (reliability), are on sale or are best sellers (appeal), and if there was a quiet price decrease (transparency).
   
```{r}
#| label: tbl-overall-vendor-score
#| tbl-cap: "Summary of overall vendor scores"
#| echo: false
#| warning: false
#| message: false

```

**Future Price Trends**
- This outcome variable represents the predicted trajectory of grocery prices over time, estimated using a Bayesian statistical model. The model incorporates historical pricing data, vendor-specific trends, and product categories to generate probabilistic forecasts. By quantifying uncertainty, the model provides a nuanced view of potential future price fluctuations, helping consumers anticipate changes and make informed decisions.
   
```{r}
#| label: tbl-future-price-trends
#| tbl-cap: "Future Price Trends"
#| echo: false
#| warning: false
#| message: false

```
   
## Predictor variables

**Temporal Information** 
- Timestamp (nowtime): This refers to the time when the data was collected. It enables the identification of trends over time, such as the seasonal impact on stock or sales. This element is critical when applying Bayesian inference to predict future price trends. From Figure 3, we see that majority of the data was collected after October, which might bring some limitations that will be discussed further into this paper.
   
```{r}
#| label: fig-nowtime
#| tbl-cap: "Nowtime Density Plot"
#| echo: false
#| warning: false
#| message: false

ggplot(analysis_data, aes(x = as.Date(nowtime))) +  # Convert to Date format for better readability
  geom_density(fill = "lightblue", color = "black") +
  labs(title = "Density of Data Collection Dates", x = "Date", y = "Density") +
  theme_minimal()

```

**Vendor Characterisics**
- Vendor Name (vendor): There are 8 vendors in this analysis: Voila, Loblaws, NoFrills, Metro, Walmart, TandT, SaveonFoods, and Galleria. This variable is crucial since we are comparing results between these vendors. For instance, we can factor in the fact that Voila has approximately 4 times the number of products compared to Galleria as seen in the table below.
   
```{r}
#| label: tbl-vendors
#| tbl-cap: "Summary table for vendors"
#| echo: false
#| warning: false
#| message: false

# Summary table for Vendor Names
vendor_summary <- analysis_data %>%
  count(vendor) %>%
  arrange(desc(n))  # Sorting by count, descending

# Display the table
knitr::kable(vendor_summary, caption = "Summary of Vendor Names", col.names = c("Vendor", "Product Count"))

```

**Product Classification**
- Food Category (food_category): Classification as “Fruits & Vegetables,” “Protein Foods,” or “Grain Products” affects weighted cost calculations. Looking at the summary table below, we see that the overall number of protein foods far outweigh grain products.

```{r}
#| label: tbl-food-category
#| tbl-cap: "Summary table for food category"
#| echo: false
#| warning: false
#| message: false

# Summary table for Food Category
category_summary <- analysis_data %>%
  count(food_category) %>%
  arrange(desc(n))  # Sorting by count, descending

# Display the table
knitr::kable(category_summary, caption = "Summary of Food Categories", col.names = c("Food Category", "Product Count"))

```

**Product Price Information**
- Current Price (current_price): This is the most recent price of a product (in CAD) used when measuring weighted costs and quiet decreases. The table below presents the price statistics for a product range, including the minimum price (0.2), maximum price (65.99), mean price (7.03), and standard deviation (5.20). The standard deviation of 5.20 is relatively high compared to the mean price of 7.03, suggesting significant variability in prices.

```{r}
#| label: tbl-current-price
#| tbl-cap: "Summary table for current price"
#| echo: false
#| warning: false
#| message: false

# Summary table for Current Price
price_summary <- analysis_data %>%
  summarise(
    Min_Price = min(current_price, na.rm = TRUE),
    Max_Price = max(current_price, na.rm = TRUE),
    Mean_Price = mean(current_price, na.rm = TRUE),
    SD_Price = sd(current_price, na.rm = TRUE)
  )

# Display the table
knitr::kable(price_summary, caption = "Summary of Current Prices", col.names = c("Min Price", "Max Price", "Mean Price", "Standard Deviation"))

```

- Quiet Price Decrease (price_decrease): Tracks subtle pricing adjustments by identifying instances where a product’s price decreased without being labeled as a sale. This outcome sheds light on subtle pricing strategies vendors might employ to remain competitive without overt promotional activities. It provides insights into whether vendors prioritize transparent discounting (sales) or discreet price reductions. As seen in @fig-price-decrease, Metro has the most number of products with decreased prices that were not on sale.

```{r}
#| label: fig-price-decrease
#| fig-cap: "Product quiet price decrease"
#| echo: false
#| warning: false
#| message: false

quiet_price_dec_bar <-
  readRDS(file = here::here("models/quiet_price_dec_bar.rds"))

```

**Stock and Promotional Indicators**
- Stock Status (stock_status): The proportion of products available (in stock) for each vendor reflects the reliability of a vendor in meeting consumer demands. Vendors with higher average stock levels may be perceived as more dependable by consumers. According to @fig-stock-status, Loblaws has the most Fruits & Vegetables, Galleria has the most Grain Products, and Metro has the most Protein Foods.

```{r}
#| label: fig-stock-status
#| fig-cap: "Product stock status"
#| echo: false
#| warning: false
#| message: false

avg_stock_facet <-
  readRDS(file = here::here("models/avg_stock_facet.rds"))

```

- On Sale (is_sale): When a product is on sale and is explicitly labeled, we can use this predictor for identifying explicit promotions that can benefit consumers. In @fig-on-sale, we measure the average number of products explicitly labeled as “on sale” per vendor, but we notice that only Voila has this label.

```{r}
#| label: fig-on-sale
#| fig-cap: "Number of products on sale"
#| echo: false
#| warning: false
#| message: false

is_sale_bar <-
  readRDS(file = here::here("models/is_sale_bar.rds"))

```

- Best Seller Status (is_best): The “Best Seller” designation is a key predictor for stock prioritization, promotional strategies, and pricing trends. As shown in @fig-best-seller, Walmart is the only vendor that explicitly uses this label, a crucial observation to consider when developing our statistical model.
 
```{r}
#| label: fig-best-seller
#| fig-cap: "Number of best-seller products"
#| echo: false
#| warning: false
#| message: false

is_best_bar <-
  readRDS(file = here::here("models/is_best_bar.rds"))

```

   - Organic Product Status (is_organic): Whether a product is “Organic” serves as a critical predictor for those who want higher quality products while risking affordability. We compare the availability of high-quality products across vendors and categories by looking for product names that include “fresh” or “organic”. In Figure 8, we see that Metro and Voila have the widest range of organic products. These products tend to be more pricey than normal products, which is a trade-off for people who want to invest in better quality over affordability.

```{r}
#| label: fig-is-organic
#| fig-cap: "Number of organic products"
#| echo: false
#| warning: false
#| message: false

organic_product_bar <-
  readRDS(file = here::here("models/organic_product_bar.rds"))

```

# Model {#sec-model}

The model is expressed as:  
$$
\text{price\_per\_standard\_unit}_i \sim \mathcal{N}(\mu_i, \sigma^2)
$$  
where:  
- $\mu_i$ is the predicted mean price for product (i).  
- $\sigma^2$ represents the residual variance.  

The mean structure is defined as:  
$$
\mu_i = \beta_0 + \beta_1 \text{nowtime}_i + \beta_2 \text{vendor}_i + \beta_3 \text{food\_category}_i + \beta_4 \text{current\_price}_i + \epsilon_i
$$  

where:  

- \(\beta_0\): Intercept representing the baseline price.  
- \(\text{nowtime}_i\): Continuous variable indicating the timestamp of data collection.  
- \(\text{vendor}_i\): Categorical variable with levels for the eight vendors: Voila, Loblaws, NoFrills, Metro, Walmart, TandT, SaveonFoods, and Galleria.  
- \(\text{food\_category}_i\): Categorical variable indicating "Fruits & Vegetables," "Protein Foods," or "Grain Products."  
- \(\text{current\_price}_i\): Continuous variable for the most recent price of a product.  
- \(\epsilon_i\): Random error term capturing unexplained variability.

## Priors  

The Bayesian model incorporates weakly informative priors to reflect plausible ranges for parameters:  
- $\beta_0 \sim \mathcal{N}(0, 10)$: Baseline prices are expected to fall within typical ranges.  
- $\beta_1, \beta_2, \beta_3, \beta_4 \sim \mathcal{N}(0, 5)$: Moderate effect sizes are prioritized, but larger effects are not ruled out.  
- $\sigma \sim \text{Student-}t(3, 0, 10)$: Allows flexibility for variance in product pricing.  

### Model Justification

The selection of predictors included or excluded in the Bayesian model was guided by their relevance, interpretability, and alignment with the research objectives. Below is a detailed breakdown:

#### Included Predictors
1. **Temporal Information**:  
   - **`nowtime`**: Captures potential seasonal trends or time-dependent price fluctuations, ensuring the model can account for temporal variability in pricing.  

2. **Vendor Characteristics**:  
   - **`vendor`**: Reflects inter-vendor differences, which are critical for evaluating affordability across vendors.  

3. **Product Classification**:  
   - **`food_category`**: Ensures the model incorporates the 2019 Canadian Food Guide’s proportional weightings for different food categories, linking the analysis to dietary guidelines.  
4. **Product Price Information**:  
   - **`current_price`**: Serves as the baseline price, providing essential context for predicting future prices.  

These features were chosen based on insights from exploratory data analysis, ensuring that the model is interpretable and reflects the underlying structure of the dataset.

---

#### Excluded Predictors
1. **Product Price Information**:  
   - **`price_decrease`**: Highlights subtle pricing strategies, such as quiet reductions, which may not be explicitly marked as sales.
   
   *Reason for Exclusion*: There may be collinearity with predictors that already account for price change such as **current_price**, and may overfit due to being highly vendor-specific.
   
2. **Stock and Promotional Indicators**:  
   - **`stock_status`**: Represents product availability and vendor reliability.  
   - **`is_sale`**: Captures the effect of explicit promotions.  
   - **`is_best`**: Evaluates the influence of "Best Seller" labels.  

   *Reason for Exclusion*:  
   These variables were excluded because they are highly vendor-specific and exhibit limited variability across vendors or over time. Including them could introduce vendor-specific biases and reduce the generalizability of the model across multiple vendors.  

2. **Organic Product Status**:  
   - **`is_organic`**: Represents consumer preferences for organic products.  

   *Reason for Exclusion*:  
   The impact of this variable is often reflected in other covariates, such as **`food_category`** or **`vendor`**. Including it could lead to redundancy and multicollinearity, complicating the model without providing significant additional insights.

---

This selection ensures the model is both parsimonious and robust, focusing on variables with the highest explanatory power while avoiding potential confounders or redundant predictors.

## Assumptions  
- The outcome variable, **`price_per_standard_unit`**, is normally distributed around the predicted mean.  
- Predictors have linear effects on the outcome.  
- Residual errors are independent and identically distributed.  
- Vendor and product effects are hierarchical, reflecting their nested relationships.

## Implementation and Validation  
The model was implemented in R using the `brms` package. Validation was done by visually checking posterior predictive checks to assess the model's fit.  

## Limitations  
The model assumes a consistent distribution of predictors across vendors and time, which may not hold in sparse data. Additionally, the linearity assumption may oversimplify complex relationships. Future iterations could explore interaction terms or non-linear effects to enhance flexibility.

## Alternative Models Considered  
Linear regression without Bayesian inference was considered but failed to incorporate uncertainty adequately. A Bayesian logistic model was evaluated for binary outcomes like **`is_sale`**, **is_best**, and **is_organic** but could not capture the continuous nature of the primary outcome. The chosen model balances complexity and interpretability while addressing hierarchical dependencies.

# Results {#sec-results}

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| label: tbl-overall-vendor-scores
#| fig-cap: ""
#| warning: false

overall_vendor_scores_bar <-
  readRDS(file = here::here("models/overall_vendor_scores_bar.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-bayesian-model
#| fig-cap: ""
#| warning: false

bayesian_model <-
  readRDS(file = here::here("models/bayesian_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-predicted-price-trend
#| fig-cap: ""
#| warning: false

predicted_price_trend <-
  readRDS(file = here::here("models/predicted_price_trend.rds"))
```


# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix: Sampling Methdology Overview - Weaknesses and Potential Improvements {#sec-appendix-A}

# Appendix: Additional Data Details {#sec-appendix-B}

## Data Cleaning Steps

To prepare the dataset for analysis, we conducted comprehensive data cleaning. First, product and price datasets were merged based on product identifiers to create a unified dataset. Rows with missing critical information, such as unit or price, were removed. To standardize product categorization, keywords were defined for three primary food categories: fruits and vegetables, protein foods, and grain products. Products matching these keywords were assigned to their respective categories, while others were excluded.

Unit standardization was implemented to ensure consistency in price comparisons. Units were cleaned, converted to lowercase, and mapped to standardized units (e.g., grams, milliliters). A conversion table was applied to normalize all prices to a standard per-unit measure. Additional flags were created to capture stock status, sale indicators, best-seller labels, and organic products based on product descriptions.

Unnecessary columns, such as URLs, brands, and redundant identifiers, were dropped to streamline the dataset. Prices were then adjusted to calculate standardized price-per-unit values, enabling direct comparisons across products and vendors. Rows with unrecognized units or missing standardized price information were filtered out. Finally, duplicate entries were removed to ensure data integrity, and the cleaned dataset was sorted by vendor for further analysis.

# Appendix: Additional Model Details {#sec-appendix-C}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

```



\newpage


# References


